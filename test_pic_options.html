<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>图像处理</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            padding: 15px;
        }
        .inline-block {
            display: inline-block;
            width: 200px;
            margin-right: 15px;
        }
        img {
            width: 200px;
            height: 200px;
        }
        #gray-bear {
            filter: grayscale(100%);
        }
    </style>
</head>
<body>

<div style="display:none;">
    <img src="img/bear.jpg" alt="" width="200" height="200" id="bear">
    <!--<img src="/zhunaoke/demo-2017-07/blob/master/img/bear.jpg?raw=true" alt="" width="200" height="200" id="bear">-->
</div>

<!--图像灰度处理-->
<h2>一、图像灰度处理</h2>
<div class="demo1">
    <h3>1、css实现的灰度处理</h3>
    <div class="inline-block">
        <p>原图:</p>
        <img src="img/bear.jpg" alt="熊">
        <!--<img src="img/confirm_btn.svg" alt="熊">-->
    </div>
    <div class="inline-block">
        <p>灰度处理后的图:</p>
        <img src="img/bear.jpg" alt="熊" id="gray-bear">
        <!--<img src="img/confirm_btn.svg" alt="熊" id="gray-bear">-->
    </div>
</div>
<div class="demo2">
    <h3>2、js实现的灰度图像</h3>
    <div class="inline-block">
        <p>
            <span>img原图</span>
        </p>
        <img src="img/bear.jpg" alt="熊">
    </div>
    <div style="min-width:900px;">
        <p>
            <span>用canvas画出来的原图:</span>
            <button onclick="copyImg()">复制原图</button>
            <button onclick="blackAndWhiteArrange()">平均值变黑白</button>
            <button onclick="blackAndWhite()">三原色变黑白</button>
        </p>
        <canvas id="gray-bear-canvas" height="200" width="900px" style="width:900px;height:200px;"></canvas>
    </div>
</div>
<!--图像清晰度处理-->
<h2>二、图像清晰度处理</h2>
<div class="demo3">

    <canvas id="file-img"></canvas>
</div>


<script>
    var bearImg = document.getElementById('bear');
    var originImgSrc = bearImg.src;
    var imgCanvas = document.getElementById('gray-bear-canvas');
    var imgCtx = imgCanvas.getContext('2d');
    var originImg = new Image();
    originImg.src = originImgSrc;
    originImg.crossOrigin = 'Anonymous';
    /**
     * 创建一份图片
     */
    function createImg() {
        var img = new Image();
        img.src = originImgSrc;
        img.crossOrigin = 'Anonymous';
        img.onload = function () {
            imgCtx.drawImage(this, 0, 0)
        }
    }
    createImg();
    /**
     * 复制原图
     */
    function copyImg() {
        console.log(originImg.width, originImg.height)
        var imgData = imgCtx.getImageData(0, 0, 200, 200);
        imgCtx.putImageData(imgData, 210, 0);
        console.log(imgData, imgData.data);
    }
    /**
     *平均色置灰
     */
    function blackAndWhiteArrange(){
        console.log(originImg.width, originImg.height);
        var imgData = imgCtx.getImageData(0, 0, 200, 200);
        var data = imgData.data;
        var length = data.length;
        for (var i = 0; i < length; i += 4) {
            var grey = (data[i] + data[i + 1] +  data[i + 2])/3;
            data[i] = data[i + 1] = data[i + 2] = grey;
        }
        imgCtx.putImageData(imgData, 420, 0);
    }
    /**
     * 将图像置为灰度图像
     */
    function blackAndWhite() {
        console.log(originImg.width, originImg.height);
        var imgData = imgCtx.getImageData(0, 0, 200, 200);
        var data = imgData.data;
        var length = data.length;
        for (var i = 0; i < length; i += 4) {
            var grey = 0.3 * data[i] + 0.59 * data[i + 1] + 0.11 * data[i + 2];
            data[i] = data[i + 1] = data[i + 2] = grey;
        }
        imgCtx.putImageData(imgData, 630, 0);
    }


</script>
</body>
</html>
